# Waterdrop
Waterdrop is a Drupal 10 in Docker quickstart project. Just run the initialize script, update composer.json with your project info, build the dev image, and run `docker compose -f dev.run.yml up` and you have a working Drupal 10 instance. Well, almost, still need to install Drupal.

It is meant to get a development environment up and running quickly. I include [Asset Packagist](https://asset-packagist.org/) configuration and use [s6-overlay](https://github.com/just-containers/s6-overlay) to run both Apache and a cron service in the same image.

I have structured it the same as my various production apps, since I will be using it to launch full apps. But, over the years I have found that when apps try to tell me how to run them in production, there is always something that just doesn't fit in my environment. So I leave how you go from dev to prod, up to you.

> NOTE: When you move to prod, make sure you think through all the settings with security in mind. Waterdrop is made with 
> development in mind. It is NOT secure. 

> Note on packages.sury.org:
> Ondrej Sury is the Debian package maintainer. He provides a more up to date
> version of php packages for Ubuntu and Debian via his custom apt repo
> and ppas. He has a Patreon if you are interested.

## Prerequisites
You should have Docker installed along with the Docker Compose plugin.

The `.sh` scripts expect to use Bash. So it needs to be installed.

`jq` is used to manipulate `composer.json` so it needs to be installed.

## Usage
### Initialization
Run `bash scripts/init.sh --help` to see the available options.

In general, `bash scripts/init.sh --project-name < something > --host-port < available port > --db-host-port < available port >` will get you started.

Don't run the `scripts/init.sh` more than once without removing everything it added.

### Building
After initialization, run `bash scripts/build-dev.sh`. 

### Running
Just run via Docker Compose.

```bash
docker compose -f dev.run.yml up -d --force-recreate
```

### Installation
After installation:
* Be sure to copy the `$settings['hash_salt']` generated by Drupal into your `secrets/PROJECTNAME_drupal_settings_hash_salt` file.
* Uncomment the bind mounts on the app service and restart the app container so that you don't need to build everytime you modify the code.

### Drupal Configuration Export/Import
When exporting and importing Drupal configuration, use the `app/src/config_sync` directory. If you need to change that, make sure to update `app/docker-config/drupal/settings.php`.

### Composer Commands
You can run Composer commands the [scripts/composer.sh](scripts/composer.sh) script, or your local instance of Composer. 

In both cases, use the `--ignore-platform-reqs` flag to bypass Composer's checks that your system can run the projects/libraries you are adding or updating. This does mean you need to make sure to adjust the Dockerfile to have those requirements without being prompted by Composer.

Using Composer via the script looks like this:

```bash
bash scripts/composer.sh composer require --ignore-platform-reqs --no-interaction --no-ansi drupal/modulename;
```

See the script for what environment vars you can use to control it.
